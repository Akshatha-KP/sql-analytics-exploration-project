/*
===============================================================================
SQL Script: Magnitude Analysis
===============================================================================
Author       : Akshatha Kumble Prabhu
Date         : 2025-12-11
Environment  : SQL Server / Gold Layer
Description  : 
    This script performs magnitude analysis on the Gold layer of the data warehouse.
    The analysis includes:
        - Customer count by country and gender
        - Product count and average cost by category
        - Total revenue by product category and by customer
        - Distribution of sold items across countries

    The purpose of this analysis is to provide a high-level understanding of 
    customer, product, and sales metrics for business decision making.
===============================================================================
*/

-- ============================
-- Total customers by country
-- ============================
SELECT 
    Country, 
    COUNT(Customer_key) AS Total_Customers 
FROM gold.dim_customer
GROUP BY Country
ORDER BY Total_Customers DESC;

-- ============================
-- Total customers by gender
-- ============================
SELECT 
    Gender, 
    COUNT(Customer_key) AS Total_Customers 
FROM gold.dim_customer
GROUP BY Gender
ORDER BY Total_Customers DESC;

-- ============================
-- Total products by category
-- ============================
SELECT 
    Category, 
    COUNT(Product_key) AS Total_Products
FROM gold.dim_products
GROUP BY Category
ORDER BY Total_Products DESC;

-- ============================
-- Average product cost by category
-- ============================
SELECT 
    Category, 
    AVG(Product_cost) AS Avg_Product_Cost
FROM gold.dim_products
GROUP BY Category
ORDER BY Avg_Product_Cost DESC;

-- ============================
-- Total revenue generated for each category
-- ============================
SELECT 
    p.Category,
    SUM(f.Sales_amount) AS Total_Revenue
FROM gold.fact_sales f
LEFT JOIN gold.dim_products p 
    ON f.Product_key = p.Product_key
GROUP BY p.Category
ORDER BY Total_Revenue DESC;

-- ============================
-- Total revenue generated by each customer
-- ============================
SELECT 
    c.Customer_id,
    CONCAT(c.First_name, ' ', c.Last_name) AS Customer_Name,
    SUM(f.Sales_amount) AS Total_Revenue
FROM gold.fact_sales f
LEFT JOIN gold.dim_customer c
    ON c.Customer_key = f.Customer_key
GROUP BY c.Customer_id, CONCAT(c.First_name, ' ', c.Last_name)
ORDER BY Total_Revenue DESC;

-- ============================
-- Distribution of sold items across countries
-- ============================
SELECT 
    c.Country,
    SUM(f.Quantity) AS Total_Sold_Items
FROM gold.fact_sales f
LEFT JOIN gold.dim_customer c
    ON c.Customer_key = f.Customer_key
GROUP BY c.Country
ORDER BY Total_Sold_Items DESC;
